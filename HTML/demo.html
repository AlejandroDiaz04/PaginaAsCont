<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/CSS/style.css" />
    <link rel="stylesheet" href="CSS-HTML/demo.css" />
    <title>Formulario Demo</title>
  </head>

  <body>
    <div id="pageLoader" class="page-loader">
      <div class="curtain top"></div>
      <div class="curtain bottom"></div>

      <div class="loader-content">
        <div class="loader-line-container">
          <div class="loader-line" id="loaderLine"></div>
        </div>
        <div class="loader-percentage-text">
          Cargando <span id="loaderPercentage">0</span>%
        </div>
      </div>
    </div>
    <div class="particles"></div>

    <main>
      <form id="demoForm">
        <h1>Deja tu solicitud y elige a qué sistema deseas acceder</h1>

        <label for="select">Sistema para demo:</label>
        <select name="select" id="select" required>
          <option value="SistemaAsCont">Sistema AsCont</option>
          <option value="AplicacionAsCont">Aplicación AsCont</option>
          <option value="OtraOpcion">Sistema y Aplicacion AsCont</option>
        </select>

        <label for="name">Nombre Completo:</label>
        <input
          type="text"
          id="name"
          name="name"
          required
          minlength="3"
          maxlength="50"
          placeholder="Ej: Freddy Mercury"
        />

        <label for="email">Correo Electrónico:</label>
        <input
          type="email"
          id="email"
          name="email"
          required
          placeholder="correo@dominio.com"
        />

        <label for="tel">Teléfono:</label>
        <input
          type="tel"
          id="tel"
          name="tel"
          required
          placeholder="Ej: +595 9XX 123456"
          pattern="[0-9+ ]+"
        />

        <div
          id="messageContainer"
          style="
            margin: 15px 0;
            padding: 10px;
            border-radius: 5px;
            display: none;
          "
        ></div>

        <button type="submit">Enviar Solicitud</button>
      </form>
    </main>
    <script src="/JS/scrips.js"></script>
    <script>
      // Manejar envío del formulario de demo
      document
        .getElementById("demoForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const formData = {
            name: document.getElementById("name").value,
            email: document.getElementById("email").value,
            tel: document.getElementById("tel").value,
            select: document.getElementById("select").value,
          };

          const messageContainer = document.getElementById("messageContainer");
          const submitBtn = this.querySelector('button[type="submit"]');

          try {
            submitBtn.disabled = true;
            submitBtn.textContent = "Enviando...";

            const response = await fetch("/backend/api/solicitud_demo.php", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(formData),
            });

            const data = await response.json();

            messageContainer.style.display = "block";

            if (data.success) {
              messageContainer.style.background = "#d4edda";
              messageContainer.style.color = "#155724";
              messageContainer.style.border = "1px solid #c3e6cb";
              messageContainer.textContent = data.message;
              this.reset();
            } else {
              messageContainer.style.background = "#f8d7da";
              messageContainer.style.color = "#721c24";
              messageContainer.style.border = "1px solid #f5c6cb";
              messageContainer.textContent = data.message;
            }
          } catch (error) {
            messageContainer.style.display = "block";
            messageContainer.style.background = "#f8d7da";
            messageContainer.style.color = "#721c24";
            messageContainer.style.border = "1px solid #f5c6cb";
            messageContainer.textContent =
              "Error al enviar el formulario. Por favor, intente nuevamente.";
          } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = "Enviar Solicitud";
          }
        });
    </script>
  </body>
</html>
